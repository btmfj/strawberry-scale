<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒã‚´é¸åˆ¥ãƒ‡ãƒãƒƒã‚°ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f0f0; }
        #video { width: 100%; max-width: 400px; background: #000; border-radius: 10px; }
        #error-log { color: red; background: #fff; padding: 10px; margin: 10px; border: 1px solid red; font-size: 0.8rem; text-align: left; display: none; }
        .btn { padding: 15px; font-size: 1.2rem; border-radius: 10px; border: none; background: #2ed573; color: white; margin: 10px; width: 80%; }
        #status { font-weight: bold; margin: 10px; }
    </style>
</head>
<body>

    <h3>ğŸ“ ã‚¤ãƒã‚´é¸åˆ¥ãƒ‡ãƒãƒƒã‚°</h3>
    
    <div id="status">1. ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
    
    <button class="btn" onclick="startCamera()">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã™ã‚‹</button>

    <div id="error-log"></div>

    <video id="video" autoplay playsinline muted></video>

    <div id="controls" style="display:none;">
        <button class="btn" style="background:#ff4757" onclick="recognizeWeight()">é‡ã•ã‚’ç¢ºå®š</button>
        <button onclick="location.reload()">ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const errorLog = document.getElementById('error-log');
        const status = document.getElementById('status');

        function logError(msg) {
            errorLog.style.display = "block";
            errorLog.innerHTML += `<div>âš ï¸ ${msg}</div>`;
        }

        async function startCamera() {
            logError("ã‚«ãƒ¡ãƒ©èµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹...");
            
            // HTTPSãƒã‚§ãƒƒã‚¯
            if (location.protocol !== 'https:') {
                logError("è­¦å‘Š: HTTPSï¼ˆhttps://...ï¼‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ãªã„ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚«ãƒ¡ãƒ©ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚");
            }

            const constraints = {
                video: { facingMode: "environment" },
                audio: false
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                await video.play();
                status.innerText = "ã‚«ãƒ¡ãƒ©èµ·å‹•æˆåŠŸï¼";
                document.getElementById('controls').style.display = "block";
                logError("æ­£å¸¸ã«ãƒ“ãƒ‡ã‚ªã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–å¾—ã—ã¾ã—ãŸã€‚");
            } catch (err) {
                logError(`ã‚¨ãƒ©ãƒ¼å: ${err.name}`);
                logError(`ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${err.message}`);
                
                if (err.name === 'NotAllowedError') {
                    logError("åŸå› : ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯è¨­å®šã§ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒã€æ‹’å¦ã€ã•ã‚Œã¦ã„ã¾ã™ã€‚");
                } else if (err.name === 'NotFoundError') {
                    logError("åŸå› : ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
                }
            }
        }

        // é‡ã•åˆ¤å®šï¼ˆç°¡æ˜“ç‰ˆï¼‰
        async function recognizeWeight() {
            status.innerText = "OCRæº–å‚™ä¸­...";
            // ä»¥å‰ã®ã‚³ãƒ¼ãƒ‰ã®OCRå‡¦ç†ã‚’ã“ã“ã«ç¶™ç¶šã—ã¦å…¥ã‚Œã‚‰ã‚Œã¾ã™
        }
    </script>
</body>
</html>
